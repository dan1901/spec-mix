name: Generate README

# Workflow disabled - README files are now manually managed
# on:
#   push:
#     branches: [ main ]
#     paths:
#       - 'README.template.md'
#       - 'README.ko.template.md'
#   workflow_dispatch:
# Can only be triggered manually via workflow_dispatch if needed
on:
  workflow_dispatch:
    
jobs:
  generate-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Render README from template
        shell: python
        env:
          GITHUB_REPOSITORY: ${{ github.repository }}
        run: |
          import os
          
          repo_slug = os.environ['GITHUB_REPOSITORY']
          repo_url = f"https://github.com/{repo_slug}"
          # Always use dan1901's GitHub Pages (org repos have Pages disabled)
          pages_url = "https://dan1901.github.io/spec-mix"
          
          replacements = {
              "{{REPO_URL}}": repo_url,
              "{{REPO_SLUG}}": repo_slug,
              "{{PAGES_URL}}": pages_url
          }
          
          for template, output in [('README.template.md', 'README.md'), ('README.ko.template.md', 'README.ko.md')]:
              with open(template, 'r', encoding='utf-8') as f:
                  content = f.read()
              
              for key, value in replacements.items():
                  content = content.replace(key, value)
              
              with open(output, 'w', encoding='utf-8') as f:
                  f.write(content)

      - name: Commit README if changed
        run: |
          # Check if README files exist and have changes (git diff doesn't work with gitignored files)
          if [ ! -f README.md ] && [ ! -f README.ko.md ]; then
            echo "README files were not generated"
            exit 1
          fi
          
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

          # Force add the gitignored files
          git add -f README.md README.ko.md
          
          # Check if there are staged changes
          if git diff --cached --quiet; then
            echo "No changes in README files"
            exit 0
          fi
          
          git commit -m "chore: update README from template [skip ci]"
          git push
