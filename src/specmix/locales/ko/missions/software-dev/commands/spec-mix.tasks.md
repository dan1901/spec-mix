---
description: 사용 가능한 설계 산출물을 기반으로 실행 가능한 의존성 순서의 tasks.md를 생성합니다.
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## 사용자 입력

```text
$ARGUMENTS

```text
진행하기 전에 사용자 입력을 **반드시** 고려해야 합니다 (비어있지 않은 경우).

## 개요

1. **설정**: 저장소 루트에서 `{SCRIPT}`를 실행하고 FEATURE_DIR 및 AVAILABLE_DOCS 목록을 파싱합니다. 모든 경로는 절대 경로여야 합니다. "I'm Groot"와 같이 인자에 작은따옴표가 있는 경우 이스케이프 구문을 사용하세요: 예: 'I'\''m Groot' (또는 가능하면 큰따옴표 사용: "I'm Groot").

2. **설계 문서 로드**: FEATURE_DIR에서 읽기:
   - **필수**: plan.md (기술 스택, 라이브러리, 구조), spec.md (우선순위가 있는 사용자 스토리)
   - **선택**: data-model.md (엔티티), contracts/ (API 엔드포인트), research.md (결정사항), quickstart.md (테스트 시나리오)
   - **헌장**: `specs/constitution.md`가 존재하면 작업 우선순위 및 구성을 위한 프로젝트 원칙을 이해하기 위해 로드
   - 참고: 모든 프로젝트에 모든 문서가 있는 것은 아닙니다. 사용 가능한 것을 기반으로 작업을 생성하세요.

3. **작업 생성 워크플로우 실행**:
   - plan.md를 로드하고 기술 스택, 라이브러리, 프로젝트 구조 추출
   - spec.md를 로드하고 우선순위(P1, P2, P3 등)가 있는 사용자 스토리 추출
   - data-model.md가 존재하면: 엔티티를 추출하고 사용자 스토리에 매핑
   - contracts/가 존재하면: 엔드포인트를 사용자 스토리에 매핑
   - research.md가 존재하면: 설정 작업을 위한 결정사항 추출
   - 헌장이 존재하면: 작업 분류 시 원칙 고려 (예: 테스트 요구사항, 코드 품질 기준, 관찰 가능성 요구사항)
   - 사용자 스토리별로 정리된 작업 생성 (아래 작업 생성 규칙 참조)
   - 사용자 스토리 완료 순서를 보여주는 의존성 그래프 생성
   - 사용자 스토리별 병렬 실행 예시 생성
   - 작업 완전성 검증 (각 사용자 스토리에 필요한 모든 작업이 있고, 독립적으로 테스트 가능)

4. **tasks.md 생성**: `.spec-mix/templates/tasks-template.md`를 구조로 사용하고 다음을 채움:
   - plan.md의 올바른 기능 이름
   - Phase 1: 설정 작업 (프로젝트 초기화)
   - Phase 2: 기반 작업 (모든 사용자 스토리의 선행 조건)
   - Phase 3+: 사용자 스토리당 하나의 페이즈 (spec.md의 우선순위 순서대로)
   - 각 페이즈 포함: 스토리 목표, 독립 테스트 기준, 테스트 (요청 시), 구현 작업
   - 마지막 페이즈: 폴리시 & 교차 관심사
   - 모든 작업은 엄격한 체크리스트 형식을 따라야 함 (아래 작업 생성 규칙 참조)
   - 각 작업의 명확한 파일 경로
   - 스토리 완료 순서를 보여주는 의존성 섹션
   - 스토리별 병렬 실행 예시
   - 구현 전략 섹션 (MVP 우선, 점진적 전달)

5. **필수: 레인 구조와 함께 Work Package 파일 생성**:
   - **필수**: tasks.md 생성 후, 반드시 Work Package 디렉토리 구조 생성
   - **강제**: `FEATURE_DIR/tasks/`에 모든 하위 디렉토리 생성: `planned/`, `doing/`, `for_review/`, `done/`
   - tasks.md의 각 작업에 대해 `planned/`에 Work Package 파일 생성:
     - 파일명: `WPxx.y.md` (xx = 페이즈 번호, y = 페이즈 내 작업 번호)
     - `.spec-mix/active-mission/templates/work-package-template.md`를 템플릿으로 사용
     - frontmatter 필드 채우기:
       - `id`: WPxx.y (예: WP01.1, WP02.3)
       - `task_id`: tasks.md의 원래 작업 ID (예: T001)
       - `title`: 작업 설명에서 추출
       - `phase`: tasks.md의 페이즈 이름
       - `lane`: 처음에는 항상 "planned"
       - `status`: 처음에는 항상 "pending"
       - `created_at`: 현재 날짜 (YYYY-MM-DD)
       - `estimated_time`: 사용자가 채우도록 [ESTIMATED_TIME]으로 남겨둠
       - `depends_on`: Dependencies 섹션에서 파싱
     - tasks.md의 작업 세부사항으로 콘텐츠 섹션 채우기
   - **강제**: 워크플로우 적용을 위한 필수 레인 구조 생성:
     ```
     tasks/
     ├─ planned/     # 모든 작업이 여기서 시작
     │   ├─ WP01.1.md
     │   ├─ WP01.2.md
     │   └─ ...
     ├─ doing/       # 작업 시작 시 여기로 이동
     ├─ for_review/  # 구현 후 여기로 이동
     └─ done/        # 수락 후 여기로 이동
     ```
   - **워크플로우 규칙**: 작업은 반드시 이 순서를 따라야 함: planned → doing → for_review → done
   - **단축 금지**: 레인 건너뛰기나 역방향 이동 불가

6. **필수 워크플로우 안내**:
   사용자에게 다음 안내 표시:
   ```
   ⚠️ 레인 워크플로우가 이제 강제됩니다 ⚠️

   모든 작업이 'planned' 레인에 생성되었습니다.

   각 작업에 대한 필수 워크플로우:
   1. 선택: 작업할 항목 선택
   2. 이동: bash .spec-mix/scripts/move-task.sh WP## planned doing [FEATURE_DIR]
   3. 구현: 코드 작성 (커밋에 반드시 [WP##] 포함)
   4. 완료: bash .spec-mix/scripts/move-task.sh WP## doing for_review [FEATURE_DIR]
   5. 검토: /spec-mix.review 실행
   6. 수락: /spec-mix.accept 실행 (done으로 이동)

   ❌ /spec-mix.implement 명령이 차단되는 경우:
   - 'doing' 레인에 작업 없음
   - 커밋에 [WP##] 참조 누락
   - 완료된 작업이 리뷰로 이동되지 않음

   작업 레인 시각화: /spec-mix.dashboard 사용
   ```

7. **보고**: 생성된 tasks.md 경로와 요약 출력:
   - 총 작업 수
   - 사용자 스토리별 작업 수
   - 식별된 병렬 실행 기회
   - 각 스토리의 독립 테스트 기준
   - 제안된 MVP 범위 (일반적으로 사용자 스토리 1만)
   - 형식 검증: 모든 작업이 체크리스트 형식을 따르는지 확인 (체크박스, ID, 라벨, 파일 경로)
   - WP 파일이 생성된 경우: 생성된 디렉토리 구조 보고

작업 생성 컨텍스트: {ARGS}

tasks.md는 즉시 실행 가능해야 합니다 - 각 작업은 LLM이 추가 컨텍스트 없이 완료할 수 있을 만큼 구체적이어야 합니다.

## 작업 생성 규칙

**중요**: 독립적인 구현 및 테스트를 가능하게 하기 위해 작업은 반드시 사용자 스토리별로 정리되어야 합니다.

**테스트는 선택사항**: 기능 사양에서 명시적으로 요청되거나 사용자가 TDD 접근 방식을 요청한 경우에만 테스트 작업을 생성합니다.

### 체크리스트 형식 (필수)

모든 작업은 이 형식을 엄격히 따라야 합니다:

```text

- [ ] [TaskID] [P?] [Story?] 파일 경로를 포함한 설명

```text
**형식 구성요소**:

1. **체크박스**: 항상 `- [ ]` (마크다운 체크박스)로 시작

2. **작업 ID**: 실행 순서의 순차 번호 (T001, T002, T003...)

3. **[P] 마커**: 작업이 병렬 실행 가능한 경우에만 포함 (다른 파일, 미완료 작업에 대한 의존성 없음)

4. **[Story] 라벨**: 사용자 스토리 페이즈 작업에만 필수
   - 형식: [US1], [US2], [US3] 등 (spec.md의 사용자 스토리에 매핑)
   - Setup 페이즈: 스토리 라벨 없음
   - Foundational 페이즈: 스토리 라벨 없음
   - User Story 페이즈: 반드시 스토리 라벨 포함
   - Polish 페이즈: 스토리 라벨 없음

5. **설명**: 정확한 파일 경로를 포함한 명확한 액션

**예시**:

- ✅ 올바름: `- [ ] T001 구현 계획에 따른 프로젝트 구조 생성`

- ✅ 올바름: `- [ ] T005 [P] src/middleware/auth.py에 인증 미들웨어 구현`

- ✅ 올바름: `- [ ] T012 [P] [US1] src/models/user.py에 User 모델 생성`

- ✅ 올바름: `- [ ] T014 [US1] src/services/user_service.py에 UserService 구현`

- ❌ 잘못됨: `- [ ] User 모델 생성` (ID와 Story 라벨 누락)

- ❌ 잘못됨: `T001 [US1] 모델 생성` (체크박스 누락)

- ❌ 잘못됨: `- [ ] [US1] User 모델 생성` (Task ID 누락)

- ❌ 잘못됨: `- [ ] T001 [US1] 모델 생성` (파일 경로 누락)

### 작업 구성

1. **사용자 스토리 (spec.md)에서** - 기본 구성:
   - 각 사용자 스토리 (P1, P2, P3...)는 자체 페이즈를 가짐
   - 관련된 모든 컴포넌트를 해당 스토리에 매핑:
     - 해당 스토리에 필요한 모델
     - 해당 스토리에 필요한 서비스
     - 해당 스토리에 필요한 엔드포인트/UI
     - 테스트 요청 시: 해당 스토리에 특화된 테스트
   - 스토리 의존성 표시 (대부분의 스토리는 독립적이어야 함)

2. **계약에서**:
   - 각 계약/엔드포인트 → 서비스하는 사용자 스토리에 매핑
   - 테스트 요청 시: 각 계약 → 해당 스토리 페이즈에서 구현 전 계약 테스트 작업 [P]

3. **데이터 모델에서**:
   - 각 엔티티를 필요로 하는 사용자 스토리에 매핑
   - 엔티티가 여러 스토리를 서비스하는 경우: 가장 빠른 스토리 또는 Setup 페이즈에 배치
   - 관계 → 적절한 스토리 페이즈의 서비스 레이어 작업

4. **설정/인프라에서**:
   - 공유 인프라 → Setup 페이즈 (Phase 1)
   - 기반/블로킹 작업 → Foundational 페이즈 (Phase 2)
   - 스토리 특화 설정 → 해당 스토리 페이즈 내

### 페이즈 구조

- **Phase 1**: Setup (프로젝트 초기화)

- **Phase 2**: Foundational (블로킹 선행 조건 - 사용자 스토리 전에 반드시 완료)

- **Phase 3+**: 우선순위 순서의 사용자 스토리 (P1, P2, P3...)
  - 각 스토리 내: 테스트 (요청 시) → 모델 → 서비스 → 엔드포인트 → 통합
  - 각 페이즈는 완전하고 독립적으로 테스트 가능한 증분이어야 함

- **마지막 페이즈**: 폴리시 & 교차 관심사
